# 🎪 축제 디지털 방명록 시스템 - 사용 메뉴얼

> 축제 및 행사를 위한 올인원 참가자 관리 시스템

## 📚 목차

1. [시스템 소개](#-시스템-소개)
2. [주요 기능](#-주요-기능)
3. [시작하기](#-시작하기)
4. [역할별 사용 가이드](#-역할별-사용-가이드)
5. [활용 시나리오](#-활용-시나리오)
6. [문제 해결](#-문제-해결)
7. [기술 정보](#-기술-정보)

---

## 🎯 시스템 소개

### 무엇을 할 수 있나요?

이 시스템은 축제나 행사에서 **참가자 정보를 디지털로 수집하고 관리**하는 웹 애플리케이션입니다.

**핵심 가치**:
- 📱 **종이 방명록 대체**: 태블릿/스마트폰으로 간편하게 작성
- 📊 **실시간 통계**: 몇 명이 왔는지, 어떤 연령대가 많은지 즉시 확인
- 🎫 **대기열 관리**: QR 코드로 순번표 자동 발급
- 💾 **데이터 자동 저장**: CSV로 다운로드하여 엑셀에서 분석
- 🚀 **설치 불필요**: 웹 브라우저만 있으면 즉시 사용

### 누가 사용하나요?

| 역할 | 할 수 있는 일 | 접속 방법 |
|------|-------------|----------|
| **👑 관리자** | 행사/부스 생성, 전체 데이터 관리, 통계 확인 | `/admin` (아이디/비밀번호) |
| **👤 부스 운영자** | 자기 부스 데이터 관리, 통계 확인, CSV 다운로드 | `/operator` (부스 코드) |
| **👥 참가자** | 방명록 작성, 대기번호 확인 | 태블릿 또는 QR 코드 스캔 |

---

## 🌟 주요 기능

### 1. 방명록 작성 (참가자용)

**특징**:
- 📝 6단계 간편 입력 (이름, 성별, 교급, 생년월일)
- 📱 모바일/태블릿 최적화 (한 화면에 표시)
- 🔄 중복 방문 자동 감지 (환영 메시지)
- 🎫 QR 접속 시 대기번호 자동 발급

**2가지 접속 방식**:

#### 방법 1: 부스 입구 고정 기기 (운영자가 설치)
```
태블릿 → 방명록 URL 접속 → 참가자가 직접 작성 → 완료 후 3초 뒤 자동 리셋
```
✅ 다음 사람이 바로 작성 가능

#### 방법 2: QR 코드 스캔 (참가자가 직접)
```
QR 스캔 → 본인 스마트폰으로 작성 → 완료 후 대기번호 페이지 표시
```
✅ 자신의 대기 순서 확인 가능

### 2. 대기열 관리

**자동 대기번호 발급**:
- 방명록 작성 완료 시 자동으로 순번 부여
- 부스별 독립적 번호 관리 (1번부터 순차적)

**참가자용 대기번호 페이지** (`/queue-ticket`):
- 🎫 내 대기번호
- 🔢 현재 진행 중인 번호
- 👥 앞에 대기 인원
- 🔄 30초마다 자동 새로고침
- 🟢/🟠/🔴 상태별 컬러 코딩:
  - 초록색: 지금 입장하세요!
  - 주황색: 다음 차례입니다! 준비해주세요
  - 노란색: 곧 차례입니다 (2-3명 남음)
  - 회색: 대기 중입니다

**운영자용 대기열 관리**:
- 📋 전체 대기 목록 확인
- ➡️ 다음 손님 호출 버튼
- 📺 TV 디스플레이 모드 (입구 모니터용)

### 3. 통계 대시보드

**실시간 통계 확인**:
- 📊 **총 방문자 수** (연인원/실인원)
- 👫 **성별 분포** (남성/여성)
- 🎓 **교급 분포** (유아/초등/중등/고등/성인)
- 🕐 **시간대별 방문** (시간별 추이 차트)
- 🔄 **중복 방문 현황**

**시각화 모드**:
- 📈 차트 모드: Chart.js 그래프
- 🎴 카드 모드: 부스별 순위 리더보드

### 4. 데이터 관리

**CSV 다운로드**:
```csv
이름,성별,교급,생년월일,방문형태,등록일시
홍길동,남성,초등,2015-03-15,첫방문,2025-01-20 14:30:00
```

**이메일 전송**:
- 📧 SendGrid API 연동
- 부스별 CSV 자동 첨부
- 무료 플랜: 일 100통, 월 3,000통

**명단 초기화**:
- 🗑️ 참가자 데이터 일괄 삭제
- 2단계 확인 (실수 방지)
- 운영자: 자기 부스만 / 관리자: 전체 삭제 가능

---

## 🚀 시작하기

### 초기 설정 (관리자)

#### STEP 1: 관리자 로그인
```
1. 웹브라우저에서 접속: https://1017-festival-dashboard.pages.dev/admin
2. 기본 계정으로 로그인:
   - 아이디: admin
   - 비밀번호: admin123!@#
   
⚠️ 첫 로그인 후 비밀번호를 변경하세요!
```

#### STEP 2: 행사 생성
```
1. 관리자 대시보드 → "행사 관리" 탭
2. "새 행사 추가" 버튼 클릭
3. 정보 입력:
   - 행사명: "2025 봄 축제"
   - 시작일: 2025-03-01
   - 종료일: 2025-03-03
4. "생성" 버튼 클릭
```

#### STEP 3: 부스 생성
```
1. "부스 관리" 탭으로 이동
2. "새 부스 추가" 버튼 클릭
3. 정보 입력:
   - 부스명: "체험 부스 A"
   - 행사 선택: "2025 봄 축제"
   - 설명: "페이스 페인팅 체험"
4. "생성" 버튼 클릭
5. ⭐ 부스 코드 저장 (예: ABC123)
```

### 부스 운영 시작 (운영자)

#### STEP 1: 부스 운영자 로그인
```
1. 접속: https://1017-festival-dashboard.pages.dev/operator
2. 부스 코드 입력: ABC123
3. "로그인" 버튼 클릭
```

#### STEP 2: 태블릿 설치 (부스 입구)
```
1. 태블릿/아이패드 준비
2. 방명록 URL 접속 (운영자 대시보드에서 "방명록 작성" 버튼 클릭)
3. 전체화면 모드로 설정
4. 부스 입구 테이블에 고정 설치
5. "첫 화면에서 참가자가 작성 시작" 안내문 부착
```

#### STEP 3: QR 코드 출력 (선택사항)
```
1. 운영자 대시보드에서 방명록 작성 페이지 접속
2. 우측 상단 QR 아이콘 클릭
3. QR 코드 이미지 저장/출력
4. 부스 입구에 "QR 스캔하여 방명록 작성" 안내문과 함께 부착
```

### TV 디스플레이 설치 (대기열 현황)

```
1. 운영자 대시보드 → "디스플레이 모드" 버튼 클릭
2. 새 창이 열림 (대기열 현황 화면)
3. 전체화면 (F11) 설정
4. TV/모니터 연결
5. 10초마다 자동 새로고침됨
```

---

## 👥 역할별 사용 가이드

### 👑 관리자 가이드

#### 로그인
```
URL: /admin
계정: admin / admin123!@#
```

#### 주요 작업

**1. 전체 통계 확인**
```
대시보드 → "개요" 탭
- 총 참가자 수
- 행사별 현황
- 부스별 참가자 랭킹
- 실시간 차트
```

**2. 행사 관리**
```
"행사 관리" 탭
→ 새 행사 추가 / 수정 / 활성화/비활성화
→ 각 행사별 통계 확인
```

**3. 부스 관리**
```
"부스 관리" 탭
→ 새 부스 추가 (부스 코드 자동 생성)
→ 부스 정보 수정
→ 부스별 참가자 수 확인
```

**4. 전체 데이터 다운로드**
```
방법 1: CSV 다운로드
- "CSV 다운로드" 버튼 클릭
- 모든 부스 데이터 포함

방법 2: JSON 백업
- "데이터 백업" 버튼 클릭
- 시스템 전체 데이터 (행사/부스/참가자 포함)
```

**5. 명단 초기화**
```
"부스 관리" 탭 → "전체 명단 초기화" 버튼
⚠️ 주의: 모든 부스의 참가자 데이터가 삭제됩니다!
```

### 👤 부스 운영자 가이드

#### 로그인
```
URL: /operator
부스 코드: 관리자가 발급한 6자리 코드 (예: ABC123)
```

#### 주요 작업

**1. 실시간 통계 확인**
```
대시보드 메인 화면
- 연인원 (총 방문 수)
- 실인원 (고유 방문자 수)
- 중복 방문 수
- 성별/교급 분포
- 시간대별 방문 추이
```

**2. 방명록 작성 안내**
```
"방명록 작성" 카드 클릭
→ 새 창에서 방명록 페이지 열림
→ 참가자에게 안내
```

**3. CSV 다운로드**
```
"CSV 다운로드" 카드 클릭
→ 자동으로 파일 다운로드
→ 파일명: booth_ABC123_20250120_143000.csv
```

**4. 이메일로 받기**
```
"이메일로 받기" 카드 클릭
→ 이메일 주소 입력
→ CSV 파일이 첨부되어 전송됨
```

**5. 대기열 관리**
```
"대기 관리" 버튼 클릭
→ 현재 대기 목록 확인
→ "다음 손님 호출" 버튼으로 순번 진행
```

**6. 명단 초기화**
```
"명단 초기화" 카드 클릭
→ 2단계 확인
→ 자기 부스 참가자만 삭제
```

**7. 디스플레이 모드**
```
"디스플레이 모드" 카드 클릭
→ 새 창에서 통계 화면
→ TV/외부 모니터 연결용
```

**8. 통계 새로고침**
```
"통계 새로고침" 카드 클릭
→ 최신 데이터로 업데이트
```

### 👥 참가자 가이드

#### 방법 1: 부스 입구 태블릿

```
STEP 1: 대기줄에서 자기 차례 기다리기

STEP 2: 태블릿 화면의 "동의하고 시작하기" 버튼 클릭

STEP 3: 6단계 정보 입력
  ① 개인정보 수집 동의
  ② 이름 입력
  ③ 성별 선택 (남성/여성)
  ④ 교급 선택 (유아/초등/중등/고등/성인)
  ⑤ 생년월일 선택 (년/월/일)
  ⑥ 완료

STEP 4: 완료 화면 3초 표시 → 자동으로 첫 화면 리셋

STEP 5: 다음 사람에게 순서 양보
```

#### 방법 2: QR 코드 스캔

```
STEP 1: 부스 입구 QR 코드 스캔

STEP 2: 본인 스마트폰으로 방명록 작성
  (6단계 동일)

STEP 3: 완료 후 대기번호 페이지 표시
  - 내 번호: #42
  - 현재 진행: #38
  - 앞에 대기: 4명

STEP 4: 자신의 차례 확인
  - 초록색: "지금 입장하세요!"
  - 주황색: "다음 차례입니다! 준비해주세요"
  - 노란색: "곧 차례입니다"

STEP 5: 차례가 되면 부스 입장
```

---

## 💡 활용 시나리오

### 시나리오 1: 소규모 축제 (부스 5개)

**상황**:
- 행사: 학교 봄 축제
- 부스: 5개 (페이스 페인팅, 포토존, 게임, 먹거리, 공예)
- 예상 참가자: 200명

**설정 흐름**:
```
1. 관리자: 행사 "학교 봄 축제" 생성
2. 관리자: 5개 부스 생성, 각 부스 코드 발급
3. 부스 운영자: 부스 코드로 로그인
4. 부스별 태블릿 1대씩 입구 설치 (총 5대)
5. 행사 시작 → 참가자들이 각 부스에서 방명록 작성
6. 운영자: 실시간 통계 확인
7. 행사 종료 후: CSV 다운로드 → 학교 보고서 작성
```

**예상 결과**:
- ✅ 200명의 참가자 정보 디지털 수집
- ✅ 부스별 인기도 분석 (가장 많이 방문한 부스)
- ✅ 성별/교급 분포 파악 (다음 행사 기획에 활용)

### 시나리오 2: 대규모 축제 (부스 20개, 대기열 필요)

**상황**:
- 행사: 지역 문화축제
- 부스: 20개 (인기 부스는 대기 발생)
- 예상 참가자: 1,000명+

**설정 흐름**:
```
1. 관리자: 행사 및 20개 부스 생성
2. 인기 부스 (5개): 대기열 시스템 활용
   - QR 코드 출력 → 입구 부착
   - TV 디스플레이 설치 (대기번호 표시)
3. 일반 부스 (15개): 태블릿만 설치
4. 참가자: QR 스캔 → 방명록 작성 → 대기번호 확인
5. 운영자: 한 명씩 호출하며 입장 관리
6. 행사 중: 관리자가 전체 통계 모니터링
7. 행사 종료 후: 전체 데이터 백업 및 분석
```

**예상 결과**:
- ✅ 대기열 혼잡 해소 (질서 유지)
- ✅ 참가자 만족도 향상 (대기 순서 명확)
- ✅ 1,000명+ 데이터 정확하게 수집

### 시나리오 3: 정기 행사 (매월 진행)

**상황**:
- 행사: 매월 첫째 주 토요일 플리마켓
- 부스: 매달 다름 (평균 10개)
- 데이터 누적 필요

**설정 흐름**:
```
1. 매월 초: 관리자가 새 행사 생성 ("2025년 3월 플리마켓")
2. 참가 부스 신청 받기 → 부스 생성
3. 부스 운영자들에게 부스 코드 전달
4. 행사 진행
5. 행사 종료 후: CSV 다운로드
6. 데이터 누적 분석:
   - 월별 참가자 추이
   - 단골 방문자 식별 (생년월일 기준)
   - 인기 부스 트렌드
```

**예상 결과**:
- ✅ 월별 참가자 수 비교 가능
- ✅ 재방문자 비율 파악
- ✅ 장기적 트렌드 분석

---

## ❓ 문제 해결

### Q1. 로그인이 안 돼요!

**관리자 로그인**:
```
✓ URL 확인: /admin 맞나요?
✓ 기본 계정: admin / admin123!@#
✓ 브라우저 쿠키 차단 해제
```

**운영자 로그인**:
```
✓ 부스 코드 확인 (대소문자 구분)
✓ 관리자가 부스를 생성했는지 확인
✓ 부스가 활성화 상태인지 확인
```

### Q2. 방명록 작성 후 대기번호가 안 나와요!

**원인 분석**:
```
QR 코드로 접속했나요?
→ YES: 대기번호 페이지 표시됨
→ NO: 3초 후 자동 리셋 (정상 동작)
```

**해결 방법**:
- 부스 입구 고정 기기: 대기번호 불필요 (다음 사람이 바로 작성)
- 참가자 개별 접속: QR 코드 사용 시에만 대기번호 표시

### Q3. CSV 다운로드가 안 돼요!

**체크리스트**:
```
✓ 브라우저 팝업 차단 해제
✓ 다운로드 폴더 권한 확인
✓ 참가자 데이터가 있는지 확인 (0명이면 다운로드 안 됨)
```

### Q4. 이메일 전송이 안 돼요!

**원인**:
```
✓ SendGrid API 키 설정 확인
✓ 발신 이메일 주소 인증 확인
✓ 일일 전송 한도 확인 (무료: 100통/일)
✓ 이메일 주소 형식 확인
```

### Q5. 통계가 업데이트 안 돼요!

**해결 방법**:
```
1. "통계 새로고침" 버튼 클릭
2. 브라우저 페이지 새로고침 (F5)
3. 로그아웃 후 재로그인
```

### Q6. 모바일에서 방명록이 잘려요!

**해결 방법**:
```
✓ 최신 버전 배포 확인 (2025-01-20 이후)
✓ 브라우저 캐시 삭제 후 새로고침
✓ 모바일 브라우저 최신 버전 사용
✓ 세로 모드에서 스크롤 가능한지 확인
```

### Q7. 대기열 번호가 안 올라가요!

**운영자 조치**:
```
1. 운영자 대시보드 → "대기 관리" 버튼 클릭
2. 현재 대기 목록 확인
3. "다음 손님 호출" 버튼 클릭
4. TV 디스플레이에서 번호 변경 확인
```

### Q8. 데이터를 실수로 삭제했어요!

**복구 불가**:
```
⚠️ 명단 초기화는 되돌릴 수 없습니다!
```

**예방 방법**:
```
1. 정기적으로 CSV 다운로드
2. 행사 종료 후 즉시 백업
3. 명단 초기화는 행사 완전 종료 후에만 실행
```

---

## 🔧 기술 정보

### 시스템 아키텍처

```
참가자 (브라우저)
    ↓
Cloudflare Pages (정적 호스팅)
    ↓
Cloudflare Workers (서버리스 함수)
    ↓
Cloudflare D1 (SQLite 데이터베이스)
```

### 기술 스택

**프론트엔드**:
- Vanilla JavaScript (No Framework)
- TailwindCSS (CDN)
- Chart.js (차트)
- Font Awesome (아이콘)

**백엔드**:
- Hono (웹 프레임워크)
- TypeScript
- Cloudflare Workers
- Cloudflare D1 (SQLite)

**인증**:
- JWT (JSON Web Token)
- PBKDF2 비밀번호 해싱

**외부 서비스**:
- SendGrid (이메일 전송)

### 데이터베이스 스키마

**admins** (관리자):
```sql
id, username, password_hash, created_at
```

**events** (행사):
```sql
id, name, start_date, end_date, is_active, created_at, updated_at
```

**booths** (부스):
```sql
id, event_id, name, booth_code, description, is_active, created_at, updated_at
```

**participants** (참가자):
```sql
id, booth_id, name, gender, grade, date_of_birth, 
has_consented, is_duplicate, created_at
```

**queue** (대기열):
```sql
id, booth_id, participant_id, queue_number, status, 
called_at, created_at
```

### API 엔드포인트 요약

| 카테고리 | 메서드 | 엔드포인트 | 설명 |
|---------|--------|-----------|------|
| 인증 | POST | `/api/auth/admin` | 관리자 로그인 |
| 인증 | POST | `/api/auth/operator` | 운영자 로그인 |
| 참가자 | POST | `/api/participants` | 참가자 등록 |
| 참가자 | GET | `/api/participants` | 참가자 목록 |
| 참가자 | DELETE | `/api/participants/reset/all` | 명단 초기화 |
| 통계 | GET | `/api/stats/booth/:id` | 부스별 통계 |
| 통계 | GET | `/api/stats/event/:id` | 행사별 통계 |
| 통계 | GET | `/api/stats/all` | 전체 통계 |
| 대기열 | POST | `/api/queue/join` | 대기열 참가 |
| 대기열 | GET | `/api/queue/status/:booth_id` | 대기 현황 |
| 대기열 | POST | `/api/queue/call-next` | 다음 손님 호출 |
| 이메일 | POST | `/api/email/send-csv` | CSV 이메일 전송 |
| 백업 | GET | `/api/backup/export` | 데이터 백업 |

### 보안 기능

- 🔒 PBKDF2 비밀번호 해싱 (100,000 iterations)
- 🔑 JWT 토큰 인증 (24시간 유효)
- 🛡️ SQL Injection 방지 (파라미터화된 쿼리)
- 🚪 역할 기반 접근 제어 (RBAC)
- 🌐 CORS 정책 적용

### 배포 정보

- **프로덕션 URL**: https://1017-festival-dashboard.pages.dev
- **플랫폼**: Cloudflare Pages
- **데이터베이스**: Cloudflare D1 (SQLite)
- **GitHub**: https://github.com/geroraymin/1017_festival-dashboard
- **마지막 업데이트**: 2025-01-20

### 환경 변수

프로덕션 배포 시 Cloudflare Dashboard에서 설정:

```bash
JWT_SECRET=your-secret-key-min-32-chars
SENDGRID_API_KEY=SG.xxxxxxxxxxxxxxxxxxxxxx
SENDGRID_FROM_EMAIL=noreply@yourdomain.com
PUBLIC_URL=https://1017-festival-dashboard.pages.dev
```

---

## 📞 지원 및 문의

### 문제 신고

GitHub Issues: https://github.com/geroraymin/1017_festival-dashboard/issues

### 기능 요청

새로운 기능이 필요하신가요? GitHub Issues에 제안해주세요!

### 라이선스

MIT License - 자유롭게 사용, 수정, 배포 가능

---

## 🎉 축하합니다!

이제 디지털 방명록 시스템을 사용할 준비가 완료되었습니다!

**다음 단계**:
1. ✅ 관리자 로그인
2. ✅ 첫 번째 행사 생성
3. ✅ 부스 생성 및 코드 발급
4. ✅ 운영자에게 부스 코드 전달
5. ✅ 태블릿 설치 및 QR 코드 출력
6. 🎊 행사 시작!

**팁**: 행사 시작 전 테스트로 방명록을 몇 개 작성해보고 CSV 다운로드까지 해보세요!

---

© 2025 제미나이 부스 디지털 방명록 시스템. All rights reserved.
